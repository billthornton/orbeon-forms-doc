<!--
    Copyright (C) 2004 Orbeon, Inc.

    The Orbeon documentation is not distributed under the LGPL license. Use of the documentation is
    subject to the following terms:

    * Conversion to other formats is allowed, but the actual content may not be altered or edited
      in any way.

    * You may create printed copies for your own personal use.

    * For all other uses, such as selling printed copies or using (parts of) the manual in another
      publication, prior written agreement from Orbeon, Inc. is required.

    Please contact Orbeon at info@orbeon.com for more information.
-->
<document xmlns:p="http://www.orbeon.com/oxf/pipeline"
    xmlns:xforms="http://www.w3.org/2002/xforms">
    <header>
        <title>XML Databases</title>
    </header>
    <body>
        <section>
            <title>Introduction</title>
            <p>
                XML databases allow you to easily store, index and query XML documents. They are
                especially useful when dealing with <i>document-centric</i> applications, where the
                structure cannot be mapped naturally to a relational database.
            </p>
            <p>
                OPS integrates with Tamino XML Server databases, as well as XML:DB databases such as
                eXist.
            </p>
        </section>
        <a name="tamino"/>
        <section>
            <title>Tamino XML Server 4.1</title>
            <p>
                Software AG's <a href="http://www.softwareag.com/tamino/">Tamino</a> provides a
                complete XML storage solution. OPS allows you to easily store, query, update, and
                delete documents in Tamino. The following sections describe the four OPS processors
                for Tamino.
            </p>
            <section>
                <title>Configuration</title>
                <p>
                    All Tamino processors have a common <code>config</code> input, describing the
                    database connection and collection.
                </p>
                <p>
                    The configuration of the Tamino processors can be done in two ways: either
                    system-wide via the <link href="reference-properties">OPS
                    Properties</link>, or locally for a specific instance of the processor through
                    the <code>config</code> input. The local configuration takes precedence if
                    available.
                </p>
                <note>
                    <p>
                        The <code>collection</code> configuration elements cannot be specified
                        system-wide.
                    </p>
                </note>
                <section>
                    <title>
                        <code>config</code> Input
                    </title>
                    <p>
                        The <code>config</code> input document specifies the URL of the Tamino
                        server, the credentials to use when connecting and the collection to
                        access. The following table describes the configuration elements.
                    </p>
                    <p>
                        <table ca="|l|p{0.6\textwidth}|">
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                            </tr>
                            <tr>
                                <td>
                                    <code>url</code>
                                </td>
                                <td>Tamino database URL.</td>
                            </tr>
                            <tr>
                                <td>
                                    <code>username</code>
                                </td>
                                <td>Username to authenticate with the server</td>
                            </tr>
                            <tr>
                                <td>
                                    <code>password</code>
                                </td>
                                <td>Password to authenticate with the server</td>
                            </tr>
                            <tr>
                                <td>
                                    <code>collection</code>
                                </td>
                                <td>XML Collection to use</td>
                            </tr>
                        </table>
                    </p>
                    <p>
                        This RelaxNG schema describes the expected
                        document.
                    </p>
                    <xml-source>
                        <element name="config" xmlns="http://relaxng.org/ns/structure/1.0"
                            datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes">
                            <interleave>
                                <optional>
                                    <element name="url">
                                        <data type="anyURI"/>
                                    </element>
                                </optional>
                                <optional>
                                    <element name="username">
                                        <data type="string"/>
                                    </element>
                                </optional>
                                <optional>
                                    <element name="password">
                                        <data type="string"/>
                                    </element>
                                </optional>
                                <element name="collection">
                                    <data type="string"/>
                                </element>
                            </interleave>
                        </element>
                    </xml-source>
                </section>
                <a name="tamino-properties"/>
                <section>
                    <title>System-Wide Configuration</title>
                    <p>
                        The Tamino processors can be configured in the <link
                        href="reference-properties">OPS properties file</link>, allowing all
                        instances to share the same configuration. The following processor
                        properties are allowed:
                    </p>
                    <table>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>
                                <code>url</code>
                            </td>
                            <td>
                                <code>anyURI</code>
                            </td>
                            <td>Tamino Server URL.</td>
                        </tr>
                        <tr>
                            <td>
                                <code>username</code>
                            </td>
                            <td>
                                <code>string</code>
                            </td>
                            <td>Username to authenticate with the server.</td>
                        </tr>
                        <tr>
                            <td>
                                <code>password</code>
                            </td>
                            <td>
                                <code>string</code>
                            </td>
                            <td>Password to authenticate with the server.</td>
                        </tr>
                    </table>
                    <p>
                        These properties are set as follows:
                    </p>
                    <xml-source>
                        <property as="xs:anyURI" processor-name="oxf:tamino-query" name="url" value="http://localhost/tamino/welcome_4_1_4"/>
                        <property as="xs:string" processor-name="oxf:tamino-query" name="username" value="..."/>
                        <property as="xs:string" processor-name="oxf:tamino-query" name="password" value="..."/>
                    </xml-source>
                    <p>
                        The following global properties are allowed:
                    </p>
                    <table>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td><code>oxf.tamino.isolation-degree</code></td>
                            <td><code>string</code></td>
                            <td>
                                Isolation degree. Possible values are:
                                <code>uncommittedDocument</code>, <code>committedCommand</code>,
                                <code>stableCursor</code>, <code>stableDocument</code>,
                                <code>serializable</code>. See the Tamino documentation for more
                                details on the isolation degree.
                            </td>
                        </tr>
                        <tr>
                            <td><code>oxf.tamino.lock-mode</code></td>
                            <td><code>string</code></td>
                            <td>
                                Lock mode. Possible values are <code>unprotected</code>,
                                <code>shared</code>, <code>protected</code>. See the Tamino
                                documentation for more details on the lock mode.
                            </td>
                        </tr>
                    </table>
                    <p>
                        These properties as set as follows:
                    </p>
                    <xml-source>
                        <property as="xs:string" name="oxf.tamino.isolation-degree" value="..."/>
                        <property as="xs:string" name="oxf.tamino.lock-mode" value="..."/>
                    </xml-source>
                </section>
            </section>
            <section>
                <title>Queries</title>
                <p>
                    The <code>oxf:tamino-query</code> processor processes queries either using
                    Tamino's X-Query or W3C XQuery.
                </p>
                <section>
                    <title>
                        <code>data</code> Input
                    </title>
                    <p>
                        The <code>data</code> input contains only the root element and the query.
                        The root element is either <code>query</code> for an X-Query query, or
                        <code>xquery</code> for an XQuery query.
                    </p>
                </section>
                <section>
                    <title>
                        <code>data</code> Output
                    </title>
                    <p>
                        The processor sends the result of the query in the <code>data</code> output.
                        The root element is always <code>result</code>.
                    </p>
                </section>
                <section>
                    <title>X-Query Example</title>
                    <p>
                        <xml-source>
                            <p:processor name="oxf:tamino-query">
                                <p:input name="config">
                                    <config>
                                        <url>http://localhost/tamino/welcome_4_1_4</url>
                                        <username>tamino</username>
                                        <password>password</password>
                                        <collection>encyclopedia</collection>
                                    </config>
                                </p:input>
                                <p:input name="data">
                                    <query>
                                        /jazzMusician[@ID="ParkerCharlie"]
                                    </query>
                                </p:input>
                                <p:output name="data" id="result"/>
                            </p:processor>
                        </xml-source>
                    </p>
                </section>
                <section>
                    <title>XQuery Example</title>
                    <p>
                        <xml-source>
                            <p:processor name="oxf:tamino-query">
                                <p:input name="config">
                                    <config>
                                        <url>http://localhost/tamino/welcome_4_1_4</url>
                                        <username>tamino</username>
                                        <password>password</password>
                                        <collection>encyclopedia</collection>
                                    </config>
                                </p:input>
                                <p:input name="data">
                                    <xquery>
                                        for $m in input()/jazzMusician,
                                        $c in input()/collaboration,
                                        $a in input()/album
                                        where $m/@ID= $c/jazzMusician  and $c/result = $a/productNo
                                        return
                                        <musician>
                                            {$m/name}
                                            <album>{$a/title}</album>
                                        </musician>

                                    </xquery>
                                </p:input>
                                <p:output name="data" id="result"/>
                            </p:processor>
                        </xml-source>
                    </p>
                </section>
            </section>
            <section>
                <title>Insertions</title>
                <p>
                    The <code>oxf:tamino-insert</code> processor allows you to insert a document in
                    Tamino.
                </p>
                <note>
                    You need to make sure that the document conforms to one of the registered
                    schemas in the current collection. If Tamino can't validate the document, an
                    exception is thrown.
                </note>
                <section>
                    <title>
                        <code>data</code> Input
                    </title>
                    <p>
                        The
                        <code>data</code> input contains the document to insert.
                    </p>
                </section>
                <section>
                    <title>Example</title>
                    <xml-source>
                        <p:processor name="oxf:tamino-insert">
                            <p:input name="config">
                                <config>
                                    <url>http://localhost/tamino/welcome_4_1_4</url>
                                    <username>tamino</username>
                                    <password>password</password>
                                    <collection>encyclopedia</collection>
                                </config>
                            </p:input>
                            <p:input name="data">
                                <jazzMusician ID="DavisMiles" type="instrumentalist">
                                    <name>
                                        <first>Miles</first>
                                        <last>Davis</last>
                                    </name>
                                    <birthDate>1926-05-26</birthDate>
                                    <instrument>trumpet</instrument>
                                </jazzMusician>
                            </p:input>
                        </p:processor>
                    </xml-source>
                </section>
            </section>
            <section>
                <title>Deletions</title>
                <p>
                    The <code>oxf:tamino-delete</code> processor allows you to remove documents
                    from Tamino.
                </p>
                <section>
                    <title>
                        <code>data</code> Input
                    </title>
                    <p>
                        The <code>data</code> input contains the X-Query to select the document(s)
                        to be removed.
                    </p>
                </section>
                <section>
                    <title>Example</title>
                    <xml-source>
                        <p:processor name="oxf:tamino-delete">
                            <p:input name="config">
                                <config>
                                    <url>http://localhost/tamino/welcome_4_1_4</url>
                                    <username>tamino</username>
                                    <password>password</password>
                                    <collection>encyclopedia</collection>
                                </config>
                            </p:input>
                            <p:input name="data">
                               <query>
                                   /jazzMusician[@ID="DavisMiles"]
                               </query>
                            </p:input>
                        </p:processor>
                    </xml-source>
                </section>
            </section>
            <section>
                <title>Updates</title>
                <p>
                    The <code>oxf:tamino-update</code> processor allows you to update parts of
                    documents directly inside Tamino. An extension of XQuery is used for that
                    purpose. Refer to the Tamino documentation for more information.
                </p>
                <section>
                    <title>
                        <code>data</code> Input
                    </title>
                    <p>
                        The <code>data</code> input contains the XQuery expression to update one or
                        multiple nodes.
                    </p>
                </section>
                <section>
                    <title>Example</title>
                    <xml-source>
                        <p:processor name="oxf:tamino-update">
                            <p:input name="config">
                                <config>
                                    <url>http://localhost/tamino/welcome_4_1_4</url>
                                    <username>tamino</username>
                                    <password>password</password>
                                    <collection>encyclopedia</collection>
                                </config>
                            </p:input>
                            <p:input name="data">
                               <query>
                                   update replace input()/jazzMusician[@ID="ParkerCharlie"]/instrument
                                   with <instrument>piano</instrument>
                               </query>
                            </p:input>
                        </p:processor>
                    </xml-source>
                </section>
            </section>

            <section>
                <title>Transactions</title>
                <p>
                    OPS initiates a transaction for every HTTP request, and commits
                    the transaction when the pipeline is executed normally. If an exception occurs
                    in the pipeline, the transaction in rolled back.
                </p>
            </section>
        </section>
        <a name="xmldb"/>
        <section>
            <title>XML:DB Databases (eXist)</title>
            <note>
                This documentation has not yet been written.
            </note>
            <!--
            <p>
                TODO
            </p>
            -->
        </section>
    </body>
</document>
