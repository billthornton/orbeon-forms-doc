<?xml version="1.0" encoding="iso-8859-1"?>
<!--
    Copyright (C) 2004 Orbeon, Inc.

    The Orbeon documentation is not distributed under the LGPL license. Use of the documentation is
    subject to the following terms:

    * Conversion to other formats is allowed, but the actual content may not be altered or edited
      in any way.

    * You may create printed copies for your own personal use.

    * For all other uses, such as selling printed copies or using (parts of) the manual in another
      publication, prior written agreement from Orbeon, Inc. is required.

    Please contact Orbeon at info@orbeon.com for more information.
-->
<document xmlns:p="http://www.orbeon.com/oxf/pipeline"
          xmlns:xforms="http://www.w3.org/2002/xforms"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <header>
        <title>Other Serializers</title>
    </header>
    <body>
        <section>
            <title>Scope</title>
            <p>
                Serializers are processors with no XML output. A serializer, just like any
                processor, can access files, connect to databases, and take actions depending on its
                inputs. See also the <a href="processors-serializers-http">HTTP serializer</a>.
            </p>
        </section>

        <a name="url-serializer"/>
        <section>
            <title>URL Serializer</title>
            <p>
                The URL Serializer mirrors the functionality of the <link
                href="processors-generators-url">URL Generator</link>. Instead of reading
                from of URL, it writes its <code>data</code> input as XML in a URL. Note that only
                the <code>oxf:</code> and <code>http:</code> protocols allows writing at this time.

            </p>
            <note>
                <p>
                    The <link href="reference-resource-managers#filesystem">Filesystem</link>
                    resource manager is the only Resource Manager supporting write operations.
                </p>
            </note>
            <p>
                The URL serializer takes a <code>config</code> input with a single <code>url</code>
                element containing the URL to write to. The <code>data</code> input is serialized
                according the rules of the XML Serializer.
            </p>
            <xml-source>
                <p:processor name="oxf:url-serializer" xmlns:p="http://www.orbeon.com/oxf/pipeline">
                    <p:input name="config">
                        <config>
                            <url>oxf:/path/current.xml</url>
                        </config>
                    </p:input>
                    <p:input name="data" href="#xml-data"/>
                </p:processor>
            </xml-source>
        </section>

        <section>
            <title>File Serializer</title>
            <p>
                The File Serializer is most useful in a <link
                href="integration-command-line">command-line application</link>. When executed, this
                serializer writes its data input into the file specified in the <code>config</code>
                element. Here is an example:
            </p>
            <xml-source>
                <p:processor name="oxf:file-serializer">
                    <p:input name="config">
                        <config>
                            <file>test.html</file>
                            <directory>c:/build/doc</directory>
                            <content-type>text/html</content-type>
                            <public-doctype>-//W3C//DTD HTML 4.01//EN</public-doctype>
                            <system-doctype>http://www.w3.org/TR/html4/strict.dtd</system-doctype>
                            <encoding>utf-8</encoding>
                            <indent-amount>4</indent-amount>
                        </config>
                    </p:input>
                    <p:input name="data" href="#html"/>
                </p:processor>
            </xml-source>
            <p>
                The <code>file</code> element specifies the file to write to.
            </p>
            <p>
                The <code>directory</code> element is optional. If specified, it is used as a base
                directory for the <code>file</code> element.
            </p>
            <p>
                The <code>content-type</code> element is optional. The default is
                <code>application/xml</code>. Other valid values are <code>text/html</code> and
                <code>text/plain</code>.
            </p>
            <p>
                The following optional attributes can also be specified:
                <code>public-doctype</code>, <code>system-doctype</code>, <code>encoding</code>,
                <code>indent</code> and <code>indent-amount</code>.
            </p>
        </section>
        <a name="scope-serializer"/>
        <section>
            <title>Scope Serializer</title>
            <p>
                The Scope serializer can store documents into the application, session and request
                scopes. It works together with the <a
                href="processors-generators#scope-generator">Scope generator</a>.
            </p>
            <p>
                The Scope serializer has a <code>config</code> input in the following format:
            </p>
            <xml-source>
                <config>
                    <key>cart</key>
                    <scope>application|session|request</scope>
                    <session-scope>application|portlet</session-scope>
                </config>
            </xml-source>
            <table>
                <tr>
                    <th>key</th>
                    <td>
                        The <code>&lt;key></code> element contains a string used to identify
                        the document. The same key must be used to store and retrieve a
                        document.
                    </td>
                </tr>
                <tr>
                    <th>scope</th>
                    <td>
                        <p>
                            The <code>&lt;scope></code> element specifies in what scope the
                            document is to be stored. The available scopes are:
                        </p>
                        <ul>
                            <li>
                                <b>application</b> - The application scope starts when the Web
                                application is deployed. It ends when the Web application is
                                undeployed. The application scope provides an efficient storage for
                                data that does not need to be persisted and that is common for all
                                users. It is typically used to cache information (e.g. configuration
                                data for the application read from a database).
                            </li>
                            <li>
                                <b>session</b> - The session scope is attached to a given user of
                                the Web application. It is typically used to store information that
                                does not need to be persisted and is specific to a given user. It is
                                typically used to cache the user's profile.
                            </li>
                            <li>
                                <b>request</b> - The request scope starts when an HTTP request is
                                sent to the server. It ends when the corresponding HTTP response is
                                sent back to the client. The request scope can be used to integrate
                                a OPS application with legacy J2EE servlets.
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <th>session-scope</th>
                    <td>
                        <p>
                            The <code>&lt;session-scope></code> element specifies in what session
                            scope the document is to be stored. This element is only allowed when
                            the &lt;scope> element is set to <code>session</code>. The available
                            session scopes are:
                        </p>
                        <ul>
                            <li>
                                <b>application</b> - access the entire application session. This is
                                always a valid value.
                            </li>
                            <li>
                                <b>portlet</b> - access the local portlet session. This is only
                                valid if the processor is run within a portlet.
                            </li>
                        </ul>
                        <p>
                            If the element is missing, a default value is used:
                            <code>application</code> when the processor runs within a servlet, and
                            <code>portlet</code> when the processor runs within a portlet.
                        </p>
                    </td>
                </tr>
            </table>
            <p>
                In addition to the <code>config</code> input, the Scope serializer has a
                <code>data</code> input receiving the document to store.
            </p>
            <note>
                <p>
                    The Session serializer, previously used, is now deprecated. Use the Scope
                    serializer with session scope instead.
                </p>
            </note>
        </section>
        <section>
            <title>Null Serializer</title>
            <p>
                The Null Serializer acts as a black hole. The <code>data</code> input is read and
                ignored. This processor is useful when a pipeline or a branch of a
                <code>p:choose</code> element doesn't have to return any document.
            </p>
            <xml-source>
                <p:processor name="oxf:null-serializer">
                    <p:input name="data" href="#document"/>
                </p:processor>
            </xml-source>
        </section>

        <section>
            <title>Flushing the Output Stream</title>
            <p>
                All serializers (XML, HTML, text, and FOP) will flush their output stream when they
                encounter the following processing instruction: <code>&lt;?oxf-serializer
                flush?&gt;</code> <p/> This instruction allows the browser to display a Web page
                incrementally. Incremental display is typically useful when sending large tables or
                when the first part of a Web page could be displayed, while the rest of the page
                cannot until a time consuming action is performed.
            </p>
        </section>

        <section>
            <title>Legacy HTTP Serializers</title>
            <note>
                <p>
                    Use of these serializers should be replaced by <a
                    href="processors-converters">converters</a> connected to the <a
                    href="processors-serializers-http">HTTP serializer</a>.
                </p>
            </note>
            <p>
                These serializers share a common functionality: writing their data input to an HTTP
                response. Typically, this means sending data back to a client web browser. This can
                be done in a Servlet environment or a Portlet environment. All share the same
                configuration, but differ in how they convert their input data. The following
                describes the common configuration, then the specifics for each serializer.
            </p>
            <note>
                <p>
                    When using the command-line mode, instead of sending the output through HTTP,
                    the HTTP serializers send their output to the standard output. In such a case,
                    the parameters that do not affect the content of the data, such as
                    content-type, status-code, etc. are ignored.
                </p>
            </note>
            <p>
                All serializers send the cache control HTTP headers, including
                <code>Last-Modified</code>, <code>Expires</code> and <code>Cache-Control</code>.
                The content type and content length headers are also supported.
            </p>

            <a name="http-configuration"/>
            <section>
                <title>Configuration</title>
                <p>
                    The configuration consists of the following optional elements.
                </p>
                <table ca="|l|p{0.3\textwidth}|p{0.2\textwidth}|">
                    <tr>
                        <th>Element</th>
                        <th>Purpose</th>
                        <th>Default</th>
                    </tr>
                    <tr>
                        <td>content-type</td>
                        <td>content type sent to the client</td>
                        <td>Specific to each serializer</td>
                    </tr>
                    <tr>
                        <td>encoding</td>
                        <td>The default text encoding</td>
                        <td>utf-8</td>
                    </tr>
                    <tr>
                        <td>status-code</td>
                        <td>HTTP status code sent to the client</td>
                        <td>SC_OK, or 100</td>
                    </tr>
                    <tr>
                        <td>error-code</td>
                        <td>HTTP error code sent to the client</td>
                        <td>none</td>
                    </tr>
                    <tr>
                        <td>empty-content</td>
                        <td>Forces the serializer to return an empty content, without reading its data input</td>
                        <td>false</td>
                    </tr>
                    <tr>
                        <td>version</td>
                        <td>HTML or XML version number</td>
                        <td>4.01 for HTML (ignored for XML, which always output 1.0)</td>
                    </tr>
                    <tr>
                        <td>public-doctype</td>
                        <td>The public doctype</td>
                        <td>&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; for HTML, none otherwise</td>
                    </tr>
                    <tr>
                        <td>system-doctype</td>
                        <td>The system doctype</td>
                        <td>&quot;http://www.w3.org/TR/html4/loose.dtd&quot; for HTML, none otherwise</td>
                    </tr>
                    <tr>
                        <td>omit-xml-declaration</td>
                        <td>Specifies whether an XML declaration must be omitted</td>
                        <td>false for XML and HTML (i.e. a declaration is output by default), ignored otherwise</td>
                    </tr>
                    <tr>
                        <td>standalone</td>
                        <td>
                            If true, specifies <code>standalone="yes"</code> in the document
                            declaration. If false, specifies <code>standalone="no"</code> in the
                            document declaration.
                        </td>
                        <td>not specified for XML, ignored otherwise</td>
                    </tr>
                    <tr>
                        <td>indent</td>
                        <td>Specifies if the output is indented</td>
                        <td>true</td>
                    </tr>
                    <tr>
                        <td>indent-amount</td>
                        <td>Specifies the number of indentation space</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>cache-control/use-local-cache</td>
                        <td>
                            Whether the resulting stream must be locally cached. For documents
                            or binaries that are large or known to change at every request, it
                            is recommended to set this to false.
                        </td>
                        <td>true</td>
                    </tr>
                    <tr>
                        <td>header</td>
                        <td>
                            Adds a custom HTTP header to the response. The nested elements
                            <code>name</code> and <code>value</code> contain the name and value
                            of the header, respectively. You can add multiple headers.
                        </td>
                        <td>none</td>
                    </tr>
                </table>
                <xml-source>
                    <config>
                        <content-type>text/html</content-type>
                        <status-code>100</status-code>
                        <empty-content>false</empty-content>
                        <error-code>0</error-code>
                        <version>4.01</version>
                        <public-doctype>-//W3C//DTD HTML 4.01//EN</public-doctype>
                        <system-doctype>http://www.w3.org/TR/html4/strict.dtd</system-doctype>
                        <omit-xml-declaration>false</omit-xml-declaration>
                        <standalone>true</standalone>
                        <encoding>utf-8</encoding>
                        <indent-amount>4</indent-amount>
                        <cache-control>
                            <use-local-cache>true</use-local-cache>
                        </cache-control>
                        <header>
                            <name>Content-Disposition</name>
                            <value>attachment; filename=image.jpeg;</value>
                        </header>
                    </config>
                </xml-source>
            </section>

            <a name="XMLSerializer"/>
            <section>
                <title>XML Serializer</title>
                <p>
                    This serializer writes XML text. The output is indented with no spaces and
                    encoded using the UTF-8 character set. The default content type is
                    <code>application/xml</code>.
                </p>
                <xml-source>
                    <p:processor name="oxf:xml-serializer">
                        <p:input name="config">
                            <config>
                                <content-type>text/vnd.wap.wml</content-type>
                            </config>
                        </p:input>
                        <p:input name="data" href="#wml"/>
                    </p:processor>
                </xml-source>
            </section>

            <a name="html-serializer"/>
            <section>
                <title>HTML Serializer</title>
                <p>
                    The HTML Serializer's output conforms to the XSLT <code>html</code> semantic.
                    The <code>doctype</code> is set to <link
                    href="http://www.w3.org/TR/1998/REC-html40-19980424/sgml/loosedtd.html">HTML
                    4.0 Transitional</link> and the content is indented with no space and encoded
                    using the UTF-8 character set. The default content type is
                    <code>text/html</code>. The following is a simple HTMLSerializer example:
                </p>
                <xml-source>
                    <p:processor name="oxf:html-serializer">
                        <p:input name="config">
                            <config/>
                        </p:input>
                        <p:input name="data" href="#html"/>
                    </p:processor>
                </xml-source>
                <note>
                    <p>
                        The <link href="http://www.w3.org/TR/2000/REC-xml-20001006">XML 1.0
                        Specification</link> prohibits a DOCTYPE definition with a Public ID and
                        no System ID.
                    </p>
                </note>
            </section>

            <section>
                <title>Text Serializer</title>
                <p>
                    The Text Serializer's output conforms to the XSLT <code>text</code> semantic.
                    The output is encoded using the UTF-8 character set. This serializer is
                    typically useful for pipelines generating Comma Separated Value (CSV) files.
                    The default content type is <code>text/plain</code>.
                </p>
                <xml-source>
                    <p:processor name="oxf:text-serializer">
                        <p:input name="config">
                            <config/>
                        </p:input>
                        <p:input name="data" href="#text"/>
                    </p:processor>
                </xml-source>
            </section>
        </section>
    </body>
</document>
